<!-- templates/router/firmware.html -->
{% extends 'router/base_router.html' %}

{% block router_content %}
<div class="bg-white rounded-xl shadow-sm p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center">
        <i class="fas fa-microchip text-blue-500 mr-3"></i>
        Firmware Management
    </h2>
    <p class="text-gray-600 mb-6">Update your router's firmware to the latest version</p>

    {% if messages %}
    {% for message in messages %}
    <div class="mb-6 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% else %}bg-red-50 text-red-700 border border-red-200{% endif %}">
        <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %} mr-2"></i>
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}

    <!-- Current Firmware Status -->
    <div class="bg-gray-50 p-6 rounded-lg mb-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
            <i class="fas fa-info-circle text-blue-500 mr-2"></i>
            Current Firmware Status
        </h3>
        
        <div class="grid md:grid-cols-2 gap-6">
            <div class="space-y-4">
                <div class="p-4 bg-white rounded-lg border border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm text-gray-600">Current Version</p>
                            <p class="text-xl font-bold text-gray-800">v2.1.8</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-code-branch text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 bg-white rounded-lg border border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm text-gray-600">Release Date</p>
                            <p class="text-lg font-medium text-gray-800">March 15, 2024</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 bg-white rounded-lg border border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm text-gray-600">Uptime</p>
                            <p class="text-lg font-medium text-gray-800">15 days, 6:32:17</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <div class="p-4 bg-white rounded-lg border {% if update_available %}border-green-200 bg-green-50{% else %}border-gray-200{% endif %}">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 rounded-lg {% if update_available %}bg-green-100 text-green-600{% else %}bg-gray-100 text-gray-600{% endif %} flex items-center justify-center mr-3">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-800">Update Status</h4>
                            <p class="text-sm {% if update_available %}text-green-600{% else %}text-gray-600{% endif %}">
                                {% if update_available %}
                                <i class="fas fa-exclamation-circle mr-1"></i> New version available!
                                {% else %}
                                <i class="fas fa-check-circle mr-1"></i> You're up to date
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    
                    {% if update_available %}
                    <div class="mt-3 p-3 bg-green-100 rounded border border-green-200">
                        <p class="text-sm text-green-800">
                            <strong>v2.2.0 available</strong> - Security patches and performance improvements
                        </p>
                    </div>
                    {% endif %}
                </div>
                
                <div class="p-4 bg-white rounded-lg border border-blue-200 bg-blue-50">
                    <div class="flex items-center">
                        <i class="fas fa-shield-alt text-blue-500 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-blue-700">Security Status</h4>
                            <p class="text-sm text-blue-600">
                                {% if update_available %}
                                <i class="fas fa-exclamation-triangle mr-1"></i> Update recommended for security
                                {% else %}
                                <i class="fas fa-check-circle mr-1"></i> Firmware is secure
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 bg-white rounded-lg border border-yellow-200 bg-yellow-50">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-500 mr-3"></i>
                        <div>
                            <h4 class="font-medium text-yellow-700">Important Notice</h4>
                            <p class="text-sm text-yellow-600">
                                Router will restart during update. Expect 3-5 minutes of downtime.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Available Updates -->
    <div class="bg-gray-50 p-6 rounded-lg mb-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
            <i class="fas fa-cloud-download-alt text-blue-500 mr-2"></i>
            Available Updates
        </h3>
        
        {% if update_available %}
        <div class="p-6 bg-white rounded-lg border border-green-200">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h4 class="text-xl font-bold text-gray-800">Firmware v2.2.0</h4>
                    <p class="text-sm text-gray-600">Released: April 10, 2024</p>
                </div>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                    <i class="fas fa-star mr-1"></i> Recommended
                </span>
            </div>
            
            <div class="mb-6">
                <h5 class="font-medium text-gray-700 mb-2">What's New:</h5>
                <ul class="space-y-2 text-gray-600">
                    <li class="flex items-start">
                        <i class="fas fa-shield-alt text-green-500 mr-2 mt-1"></i>
                        <span>Security patches for critical vulnerabilities</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-bolt text-blue-500 mr-2 mt-1"></i>
                        <span>Improved Wi-Fi performance and stability</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-bug text-red-500 mr-2 mt-1"></i>
                        <span>Fixed memory leak issue</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-wifi text-purple-500 mr-2 mt-1"></i>
                        <span>Enhanced parental controls features</span>
                    </li>
                </ul>
            </div>
            
            <div class="mb-6">
                <h5 class="font-medium text-gray-700 mb-2">Update Size:</h5>
                <div class="flex items-center">
                    <i class="fas fa-hdd text-gray-400 mr-2"></i>
                    <span class="text-gray-600">42.5 MB</span>
                    <span class="mx-2">â€¢</span>
                    <i class="fas fa-clock text-gray-400 mr-2"></i>
                    <span class="text-gray-600">Estimated time: 3-5 minutes</span>
                </div>
            </div>
            
            <form method="post">
                {% csrf_token %}
                <div class="flex items-center space-x-4">
                    <button type="submit" 
                            class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center">
                        <i class="fas fa-download mr-2"></i>
                        Install Update Now
                    </button>
                    <button type="button" onclick="scheduleUpdate()" 
                            class="px-6 py-3 border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50 transition">
                        <i class="fas fa-clock mr-2"></i>
                        Schedule Update
                    </button>
                </div>
                <p class="mt-3 text-sm text-gray-500">
                    <i class="fas fa-exclamation-triangle mr-1"></i>
                    Your router will restart during the update. All devices will be temporarily disconnected.
                </p>
            </form>
        </div>
        {% else %}
        <div class="text-center py-8">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            <h4 class="text-lg font-medium text-gray-800 mb-2">You're Up to Date!</h4>
            <p class="text-gray-600 mb-4">Your router is running the latest firmware version.</p>
            <button onclick="checkForUpdates()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                <i class="fas fa-sync-alt mr-2"></i> Check for Updates
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Update History -->
    <div class="bg-gray-50 p-6 rounded-lg">
        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
            <i class="fas fa-history text-blue-500 mr-2"></i>
            Update History
        </h3>
        
        <div class="space-y-4">
            <!-- Previous Update 1 -->
            <div class="p-4 bg-white rounded-lg border border-gray-200">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <h4 class="font-medium text-gray-800">Firmware v2.1.8</h4>
                        <p class="text-sm text-gray-600">Installed: March 15, 2024</p>
                    </div>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        Previous
                    </span>
                </div>
                <p class="text-sm text-gray-600">
                    Minor bug fixes and performance improvements
                </p>
            </div>
            
            <!-- Previous Update 2 -->
            <div class="p-4 bg-white rounded-lg border border-gray-200">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <h4 class="font-medium text-gray-800">Firmware v2.1.7</h4>
                        <p class="text-sm text-gray-600">Installed: February 1, 2024</p>
                    </div>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        Security Update
                    </span>
                </div>
                <p class="text-sm text-gray-600">
                    Security patches and stability improvements
                </p>
            </div>
            
            <!-- Previous Update 3 -->
            <div class="p-4 bg-white rounded-lg border border-gray-200">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <h4 class="font-medium text-gray-800">Firmware v2.1.6</h4>
                        <p class="text-sm text-gray-600">Installed: December 15, 2023</p>
                    </div>
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        Feature Update
                    </span>
                </div>
                <p class="text-sm text-gray-600">
                    Added guest network improvements and parental controls
                </p>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
            <div class="flex">
                <i class="fas fa-lightbulb text-yellow-500 mr-3 mt-1"></i>
                <div>
                    <h4 class="font-medium text-yellow-700">Update Tips</h4>
                    <ul class="mt-2 text-sm text-yellow-600 space-y-1">
                        <li><i class="fas fa-check mr-2"></i> Always backup your router settings before updating</li>
                        <li><i class="fas fa-check mr-2"></i> Schedule updates during off-hours to minimize disruption</li>
                        <li><i class="fas fa-check mr-2"></i> Don't power off the router during update process</li>
                        <li><i class="fas fa-check mr-2"></i> Wait 5-10 minutes after update for router to stabilize</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Schedule Update Modal -->
<div id="scheduleModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Schedule Firmware Update</h3>
            
            <form id="scheduleForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Update Time</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Date</label>
                            <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   value="{{ tomorrow|date:'Y-m-d' }}" min="{{ today|date:'Y-m-d' }}">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Time</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="01:00">1:00 AM</option>
                                <option value="02:00">2:00 AM</option>
                                <option value="03:00" selected>3:00 AM (Recommended)</option>
                                <option value="04:00">4:00 AM</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Notification</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 rounded" checked>
                            <span class="ml-2 text-gray-700">Send notification before update</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 rounded" checked>
                            <span class="ml-2 text-gray-700">Send notification after update</span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Auto-reconnect</label>
                    <p class="text-sm text-gray-600 mb-2">Automatically reconnect devices after update?</p>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        <span class="ml-3 text-sm text-gray-700">Yes</span>
                    </label>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                    <button type="button" onclick="hideScheduleModal()" 
                            class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Schedule Update
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
let updateScheduled = false;

function scheduleUpdate() {
    document.getElementById('scheduleModal').classList.remove('hidden');
}

function hideScheduleModal() {
    document.getElementById('scheduleModal').classList.add('hidden');
}

function checkForUpdates() {
    // Show loading state
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Checking...';
    button.disabled = true;
    
    // Simulate API call
    setTimeout(() => {
        button.innerHTML = '<i class="fas fa-check mr-2"></i> No Updates Available';
        button.className = 'px-4 py-2 bg-gray-600 text-white rounded-lg transition';
        
        // Reset after 3 seconds
        setTimeout(() => {
            button.innerHTML = originalText;
            button.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition';
            button.disabled = false;
        }, 3000);
    }, 2000);
}

// Handle schedule form submission
document.getElementById('scheduleForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Show success message
    alert('Firmware update scheduled successfully!');
    hideScheduleModal();
    updateScheduled = true;
    
    // Update UI to show scheduled update
    const updateButton = document.querySelector('[type="submit"]');
    if (updateButton) {
        updateButton.innerHTML = '<i class="fas fa-clock mr-2"></i> Update Scheduled';
        updateButton.className = 'px-6 py-3 bg-yellow-600 text-white rounded-lg transition';
        updateButton.disabled = true;
    }
});

// Show warning before leaving page during update
window.addEventListener('beforeunload', function(e) {
    const updateInProgress = document.querySelector('form[method="post"] button[type="submit"]:disabled');
    if (updateInProgress) {
        e.preventDefault();
        e.returnValue = 'Firmware update is in progress. Are you sure you want to leave?';
        return 'Firmware update is in progress. Are you sure you want to leave?';
    }
});

// Initialize date inputs
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    const dateInput = document.querySelector('input[type="date"]');
    if (dateInput) {
        dateInput.min = today.toISOString().split('T')[0];
        dateInput.value = tomorrow.toISOString().split('T')[0];
    }
});
</script>
{% endblock %}