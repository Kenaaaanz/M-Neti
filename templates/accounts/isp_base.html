<!-- templates/accounts/isp_base.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ISP Dashboard - M-Neti{% endblock %}</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Base ISP Styles - SIMPLIFIED -->
    <style>
        /* CSS Variables for consistent theming */
        :root {
            --sidebar-bg: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
            --sidebar-text: #dbeafe;
            --sidebar-hover: rgba(255, 255, 255, 0.1);
            --sidebar-active: #3b82f6;
            --header-bg: #ffffff;
            --main-bg: #f9fafb;
        }
        
        * {
            box-sizing: border-box;
        }
        
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        
        /* Main Layout */
        .main-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Sidebar - Consistent with superadmin */
        .sidebar {
            width: 16rem; /* 64 * 0.25rem = 16rem */
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            height: 100vh;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Navigation Links - Consistent styling */
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: var(--sidebar-text);
            border-radius: 0.5rem;
            text-decoration: none;
            transition: all 0.2s ease;
            margin-bottom: 0.25rem;
        }
        
        .nav-item:hover {
            background-color: var(--sidebar-hover);
        }
        
        .nav-item.active {
            background-color: var(--sidebar-active);
            color: white;
        }
        
        .nav-icon {
            width: 1.25rem;
            margin-right: 0.75rem;
            text-align: center;
        }
        
        /* Badge styling - Consistent */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 9999px;
            background-color: #ef4444;
            color: white;
            font-weight: 600;
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            overflow: hidden;
        }
        
        /* Header - Consistent with superadmin */
        .page-header {
            background: var(--header-bg);
            border-bottom: 1px solid #e5e7eb;
            flex-shrink: 0;
        }
        
        /* Content Area */
        .content-area {
            flex: 1;
            overflow-y: auto;
            background: var(--main-bg);
        }
        
        /* Footer - Consistent */
        .page-footer {
            background: var(--header-bg);
            border-top: 1px solid #e5e7eb;
            flex-shrink: 0;
        }
        
        /* Scrollbar styling */
        .sidebar-content::-webkit-scrollbar {
            width: 4px;
        }
        
        .sidebar-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .sidebar-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
    </style>
    
    <!-- Page-specific CSS -->
    {% block extra_css %}
    {% endblock %}
</head>
<body class="bg-gray-50">
    <!-- Main Layout -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Logo/Brand -->
            <div class="sidebar-header">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                        <i class="fas fa-wifi text-blue-600 text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">M-Neti</h1>
                        <p class="text-blue-200 text-xs">ISP Portal</p>
                    </div>
                </div>
            </div>

            <!-- Tenant Info -->
            <div class="px-4 py-3 border-b border-blue-700">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-building text-white text-sm"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-white truncate">
                            {{ tenant.name|default:"No Tenant" }}
                        </p>
                        <p class="text-xs text-blue-200 truncate">
                            {{ tenant.company_name|default:"ISP Provider" }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- User Info -->
            <div class="px-4 py-3 border-b border-blue-700">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-sm font-semibold">
                            {{ user.first_name|first|default:user.username|first }}{{ user.last_name|first }}
                        </span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-white truncate">
                            {{ user.get_full_name|default:user.username }}
                        </p>
                        <p class="text-xs text-blue-200 capitalize">
                            {{ user.role|default:"user" }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="sidebar-content">
                <!-- Dashboard -->
                <a href="{% url 'isp_dashboard' %}" 
                   class="nav-item {% if request.resolver_match.url_name == 'isp_dashboard' %}active{% endif %}">
                    <i class="nav-icon fas fa-tachometer-alt"></i>
                    <span class="flex-1">Dashboard</span>
                </a>

                <!-- Pending Approvals -->
                <a href="{% url 'isp_pending_approvals' %}" 
                   class="nav-item {% if request.resolver_match.url_name == 'isp_pending_approvals' %}active{% endif %}">
                    <i class="nav-icon fas fa-user-clock"></i>
                    <span class="flex-1">Pending Approvals</span>
                    {% if pending_count and pending_count > 0 %}
                    <span class="badge ml-2">{{ pending_count }}</span>
                    {% endif %}
                </a>

                <!-- SMS Management -->
                <a href="{% url 'isp_sms_management' %}" 
                   class="nav-item {% if request.resolver_match.url_name == 'isp_sms_management' %}active{% endif %}">
                    <i class="nav-icon fas fa-sms"></i>
                    <span class="flex-1">SMS Management</span>
                </a>

                <!-- Customer Management -->
                <a href="{% url 'isp_customers' %}" 
                   class="nav-item {% if request.resolver_match.url_name == 'isp_customers' %}active{% endif %}">
                    <i class="nav-icon fas fa-users"></i>
                    <span class="flex-1">Customer Management</span>
                </a>

                <!-- Customer Map -->
                <a href="{% url 'isp_customer_map' %}" 
                   class="nav-item {% if request.resolver_match.url_name == 'isp_customer_map' %}active{% endif %}">
                    <i class="nav-icon fas fa-map"></i>
                    <span class="flex-1">Customer Map</span>
                </a>

                <!-- Router Management -->
                <a href="{% url 'isp_routers' %}" 
                   class="nav-item {% if request.resolver_match.url_name == 'isp_routers' %}active{% endif %}">
                    <i class="nav-icon fas fa-wifi"></i>
                    <span class="flex-1">Router Management</span>
                </a>

                <!-- Plan Management -->
                <a href="{% url 'isp_plans' %}" 
                   class="nav-item {% if request.resolver_match.url_name == 'isp_plans' %}active{% endif %}">
                    <i class="nav-icon fas fa-cubes"></i>
                    <span class="flex-1">Plan Management</span>
                </a>

                <!-- Payment Management -->
                <a href="{% url 'isp_payments' %}" 
                   class="nav-item {% if request.resolver_match.url_name == 'isp_payments' %}active{% endif %}">
                    <i class="nav-icon fas fa-credit-card"></i>
                    <span class="flex-1">Payments</span>
                </a>

                <!-- Settings Section -->
                <div class="mt-6 pt-6 border-t border-blue-700 space-y-2">
                    <!-- Profile Settings -->
                    <a href="{% url 'profile' %}" class="nav-item">
                        <i class="nav-icon fas fa-user-cog"></i>
                        <span class="flex-1">Profile Settings</span>
                    </a>

                    <!-- Bulk Data Marketplace -->
                    <a href="{% url 'bulk_data_marketplace' %}" 
                       class="nav-item {% if request.resolver_match.url_name == 'bulk_data_marketplace' %}active{% endif %}">
                        <i class="nav-icon fas fa-database"></i>
                        <span class="flex-1">Bulk Data Marketplace</span>
                    </a>

                    <!-- Data Wallet -->
                    <a href="{% url 'isp_data_wallet' %}" 
                       class="nav-item {% if request.resolver_match.url_name == 'isp_data_wallet' %}active{% endif %}">
                        <i class="nav-icon fas fa-wallet"></i>
                        <span class="flex-1">Data Wallet</span>
                    </a>
                </div>
            </div>
            
            <!-- Logout -->
            <div class="sidebar-footer">
                <a href="{% url 'logout' %}" class="nav-item text-red-100 bg-red-500/20 hover:bg-red-600 hover:text-white">
                    <i class="nav-icon fas fa-sign-out-alt"></i>
                    <span class="flex-1">Logout</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="page-header px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <h2 class="text-xl font-semibold text-gray-800">
                            {% block page_title %}ISP Dashboard{% endblock %}
                        </h2>
                        <p class="text-sm text-gray-500 mt-1">
                            {% block page_subtitle %}Manage your ISP operations{% endblock %}
                        </p>
                    </div>
                    
                    <div class="flex items-center space-x-6">
                        <!-- Notifications -->
                        <div class="relative">
                            <button class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-bell text-xl"></i>
                                {% if pending_count and pending_count > 0 %}
                                <span class="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>
                                {% endif %}
                            </button>
                        </div>

                        <!-- Live Chat -->
                        <div class="relative">
                            <a href="{% url 'isp_support_chat' %}" class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-comments text-xl"></i>
                            </a>
                        </div>

                        <!-- Quick Stats -->
                        <div class="flex items-center space-x-6 text-sm">
                            <div class="text-center">
                                <div class="text-lg font-semibold text-gray-900">
                                    {{ total_customers|default:"0" }}
                                </div>
                                <div class="text-xs text-gray-500">Customers</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-semibold text-green-600">
                                    {{ online_routers|default:"0" }}
                                </div>
                                <div class="text-xs text-gray-500">Online</div>
                            </div>
                        </div>

                        <!-- Date & Time -->
                        <div class="text-right">
                            <div class="text-sm font-medium text-gray-900" id="current-time">Loading...</div>
                            <div class="text-xs text-gray-500" id="current-date">Loading...</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Messages/Alerts -->
            {% if messages %}
            <div class="absolute top-0 left-0 right-0 z-50">
                <div class="container mx-auto px-6 py-4">
                    {% for message in messages %}
                    <div class="message-fade {% if message.tags == 'error' %}bg-red-50 border border-red-200 text-red-700{% elif message.tags == 'warning' %}bg-yellow-50 border border-yellow-200 text-yellow-700{% else %}bg-green-50 border border-green-200 text-green-700{% endif %} rounded-lg p-4 mb-4 shadow-sm">
                        <div class="flex items-center">
                            <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% else %}fa-check-circle{% endif %} mr-3"></i>
                            <span class="font-medium">{{ message }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Content Area -->
            <main class="content-area">
                <!-- Main Content Block -->
                <div class="p-6">
                    {% block content %}
                    <!-- Page-specific content goes here -->
                    {% endblock %}
                </div>
            </main>

            <!-- Footer -->
            <footer class="page-footer py-4">
                <div class="container mx-auto px-6">
                    <div class="flex flex-col md:flex-row items-center justify-between space-y-2 md:space-y-0">
                        <div class="text-sm text-gray-500">
                            &copy; 2024 M-Neti ISP Portal. All rights reserved.
                        </div>
                        <div class="text-sm text-gray-500">
                            {{ tenant.name|default:"M-Neti" }} â€¢ {{ tenant.primary_domain|default:"M-Neti.com" }}
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Base JavaScript -->
    <script>
        // Update current time and date
        function updateDateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            const date = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const timeElement = document.getElementById('current-time');
            const dateElement = document.getElementById('current-date');
            
            if (timeElement) timeElement.textContent = time;
            if (dateElement) dateElement.textContent = date;
        }

        updateDateTime();
        setInterval(updateDateTime, 60000);

        // Add active state to current page link
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.nav-item');
            
            navLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href && currentPath.startsWith(href) && href !== '/') {
                    link.classList.add('active');
                }
                
                if (href === '/' && currentPath === '/') {
                    link.classList.add('active');
                }
            });
        });

        // Auto-dismiss messages
        document.addEventListener('DOMContentLoaded', function() {
            const messages = document.querySelectorAll('.message-fade');
            messages.forEach(message => {
                setTimeout(() => {
                    message.style.opacity = '0';
                    setTimeout(() => {
                        if (message.parentNode) {
                            message.remove();
                        }
                    }, 500);
                }, 5000);
            });
        });
        
        // Ensure sidebar scrolls properly
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarContent = document.querySelector('.sidebar-content');
            if (sidebarContent) {
                sidebarContent.style.maxHeight = 'calc(100vh - 280px)'; // Adjust based on header/footer heights
            }
        });
    </script>

    <!-- SMS Quick Action Button -->
    <div class="fixed bottom-6 right-6 z-40">
        <a href="{% url 'isp_sms_compose' %}" 
           class="flex items-center justify-center w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 hover:shadow-xl transition-all duration-300 transform hover:scale-110"
           title="Send Bulk SMS">
            <i class="fas fa-paper-plane text-xl"></i>
        </a>
    </div>

    {% block extra_js %}
    <!-- Page-specific JavaScript goes here -->
    {% endblock %}
</body>
</html>