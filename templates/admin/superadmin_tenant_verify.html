<!-- templates/admin/superadmin_tenant_verify.html -->
{% extends 'accounts/superadmin_base.html' %}
{% load static %}

{% block title %}Verify ISP - {{ tenant.name }} - M-Neti{% endblock %}

{% block page_title %}Verify ISP: {{ tenant.name }}{% endblock %}
{% block page_subtitle %}Review and verify ISP documentation and compliance{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="{% url 'superadmin_tenant_detail' tenant.id %}" class="inline-flex items-center text-blue-600 hover:text-blue-800 mb-4">
        <i class="fas fa-arrow-left mr-2"></i> Back to ISP Details
    </a>
</div>

<!-- Verification Status -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
    <div class="flex items-center justify-between">
        <div>
            <h2 class="text-xl font-bold text-gray-900">ISP Verification Status</h2>
            <div class="flex items-center space-x-3 mt-2">
                {% if tenant.is_verified %}
                <span class="px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-800 flex items-center">
                    <i class="fas fa-check-circle mr-2"></i> Verified
                </span>
                <span class="text-sm text-gray-600">Verified on {{ tenant.verification_date|date:"F d, Y" }}</span>
                {% else %}
                <span class="px-4 py-2 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 flex items-center">
                    <i class="fas fa-clock mr-2"></i> Pending Verification
                </span>
                <span class="text-sm text-gray-600">Submitted on {{ tenant.created_at|date:"F d, Y" }}</span>
                {% endif %}
            </div>
        </div>
        <div>
            {% if tenant.is_verified %}
            <button onclick="unverifyISP('{{ tenant.id }}')" 
                    class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg">
                <i class="fas fa-times-circle mr-2"></i> Unverify ISP
            </button>
            {% else %}
            <button onclick="verifyISP('{{ tenant.id }}')" 
                    class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg">
                <i class="fas fa-check-circle mr-2"></i> Verify ISP
            </button>
            {% endif %}
        </div>
    </div>
</div>

<!-- Verification Checklist -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Documentation Checklist -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-file-alt text-blue-600 mr-2"></i>
            Documentation Checklist
        </h3>
        
        <div class="space-y-4">
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                        {% if tenant.business_registration %}
                        <i class="fas fa-check text-blue-600"></i>
                        {% else %}
                        <i class="fas fa-times text-gray-400"></i>
                        {% endif %}
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Business Registration</p>
                        <p class="text-sm text-gray-500">Valid business license/certificate</p>
                    </div>
                </div>
                {% if tenant.business_registration %}
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                    Provided
                </span>
                {% else %}
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
                    Missing
                </span>
                {% endif %}
            </div>
            
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                        {% if tenant.tax_certificate %}
                        <i class="fas fa-check text-blue-600"></i>
                        {% else %}
                        <i class="fas fa-times text-gray-400"></i>
                        {% endif %}
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Tax Compliance Certificate</p>
                        <p class="text-sm text-gray-500">Valid tax registration</p>
                    </div>
                </div>
                {% if tenant.tax_certificate %}
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                    Provided
                </span>
                {% else %}
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
                    Missing
                </span>
                {% endif %}
            </div>
            
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                        {% if tenant.id_document %}
                        <i class="fas fa-check text-blue-600"></i>
                        {% else %}
                        <i class="fas fa-times text-gray-400"></i>
                        {% endif %}
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Director ID Document</p>
                        <p class="text-sm text-gray-500">Government-issued ID</p>
                    </div>
                </div>
                {% if tenant.id_document %}
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                    Provided
                </span>
                {% else %}
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
                    Missing
                </span>
                {% endif %}
            </div>
            
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                        {% if tenant.bank_details %}
                        <i class="fas fa-check text-blue-600"></i>
                        {% else %}
                        <i class="fas fa-times text-gray-400"></i>
                        {% endif %}
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Bank Account Details</p>
                        <p class="text-sm text-gray-500">For revenue payments</p>
                    </div>
                </div>
                {% if tenant.bank_details %}
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                    Provided
                </span>
                {% else %}
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
                    Missing
                </span>
                {% endif %}
            </div>
            
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                        <i class="fas fa-check text-blue-600"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Service Level Agreement</p>
                        <p class="text-sm text-gray-500">Terms and conditions</p>
                    </div>
                </div>
                <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                    Accepted
                </span>
            </div>
        </div>
    </div>
    
    <!-- Verification Actions -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-user-check text-green-600 mr-2"></i>
            Verification Actions
        </h3>
        
        <div class="space-y-6">
            <!-- Verification Status -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Verification Status</label>
                <div class="flex space-x-3">
                    <button onclick="updateVerificationStatus('{{ tenant.id }}', 'verified')" 
                            class="flex-1 px-4 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg text-center">
                        <i class="fas fa-check-circle mr-2"></i> Mark as Verified
                    </button>
                    <button onclick="updateVerificationStatus('{{ tenant.id }}', 'pending')" 
                            class="flex-1 px-4 py-3 bg-yellow-600 hover:bg-yellow-700 text-white font-medium rounded-lg text-center">
                        <i class="fas fa-clock mr-2"></i> Mark as Pending
                    </button>
                    <button onclick="updateVerificationStatus('{{ tenant.id }}', 'rejected')" 
                            class="flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-center">
                        <i class="fas fa-times-circle mr-2"></i> Reject
                    </button>
                </div>
            </div>
            
            <!-- Verification Notes -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Verification Notes</label>
                <textarea id="verificationNotes" rows="4" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          placeholder="Add verification notes or requirements...">{{ tenant.verification_notes|default:"" }}</textarea>
            </div>
            
            <!-- Document Requests -->
            <div>
                <h4 class="font-medium text-gray-700 mb-2">Request Additional Documents</h4>
                <div class="space-y-2">
                    <button onclick="requestDocument('{{ tenant.id }}', 'business_registration')" 
                            class="w-full px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-left">
                        <i class="fas fa-file-contract mr-2"></i> Business Registration Certificate
                    </button>
                    <button onclick="requestDocument('{{ tenant.id }}', 'tax_certificate')" 
                            class="w-full px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-left">
                        <i class="fas fa-file-invoice-dollar mr-2"></i> Tax Compliance Certificate
                    </button>
                    <button onclick="requestDocument('{{ tenant.id }}', 'id_document')" 
                            class="w-full px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-left">
                        <i class="fas fa-id-card mr-2"></i> Director ID Document
                    </button>
                </div>
            </div>
            
            <!-- Verification History -->
            {% if verification_history %}
            <div class="pt-4 border-t border-gray-200">
                <h4 class="font-medium text-gray-700 mb-2">Verification History</h4>
                <div class="space-y-2 max-h-60 overflow-y-auto">
                    {% for history in verification_history|slice:":5" %}
                    <div class="p-2 bg-gray-50 rounded">
                        <div class="flex justify-between">
                            <span class="text-sm font-medium">{{ history.status|title }}</span>
                            <span class="text-xs text-gray-500">{{ history.timestamp|date:"M d, Y H:i" }}</span>
                        </div>
                        <p class="text-xs text-gray-600 mt-1">{{ history.notes|default:"No notes" }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Compliance Information -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
        <i class="fas fa-balance-scale text-orange-600 mr-2"></i>
        Compliance Information
    </h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <h4 class="font-medium text-gray-700 mb-2">Business Information</h4>
            <dl class="space-y-2">
                <div class="flex justify-between">
                    <dt class="text-sm text-gray-600">Business Type:</dt>
                    <dd class="text-sm font-medium">{{ tenant.business_type|default:"Not specified" }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-sm text-gray-600">Registration Number:</dt>
                    <dd class="text-sm font-medium">{{ tenant.registration_number|default:"Not provided" }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-sm text-gray-600">Tax ID:</dt>
                    <dd class="text-sm font-medium">{{ tenant.tax_id|default:"Not provided" }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-sm text-gray-600">Years in Operation:</dt>
                    <dd class="text-sm font-medium">{{ tenant.years_in_operation|default:"Not specified" }}</dd>
                </div>
            </dl>
        </div>
        
        <div>
            <h4 class="font-medium text-gray-700 mb-2">Contact Person</h4>
            <dl class="space-y-2">
                <div class="flex justify-between">
                    <dt class="text-sm text-gray-600">Name:</dt>
                    <dd class="text-sm font-medium">{{ tenant.contact_person|default:"Not specified" }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-sm text-gray-600">Position:</dt>
                    <dd class="text-sm font-medium">{{ tenant.contact_position|default:"Not specified" }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-sm text-gray-600">Phone:</dt>
                    <dd class="text-sm font-medium">{{ tenant.contact_phone|default:"Not provided" }}</dd>
                </div>
                <div class="flex justify-between">
                    <dt class="text-sm text-gray-600">Email:</dt>
                    <dd class="text-sm font-medium">{{ tenant.contact_email }}</dd>
                </div>
            </dl>
        </div>
    </div>
</div>

<!-- Action Log -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
            <i class="fas fa-history text-purple-600 mr-2"></i>
            Verification Actions Log
        </h3>
        <button onclick="exportVerificationLog('{{ tenant.id }}')" 
                class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg">
            <i class="fas fa-download mr-1"></i> Export Log
        </button>
    </div>
    
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead>
                <tr class="bg-gray-50">
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">Date</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">Action</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">Status</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">Notes</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">By</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for log in action_logs|slice:":10" %}
                <tr>
                    <td class="px-4 py-2 text-sm text-gray-600">{{ log.timestamp|date:"M d, Y H:i" }}</td>
                    <td class="px-4 py-2 text-sm text-gray-900">{{ log.action|title }}</td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 text-xs font-medium rounded-full
                            {% if log.status == 'verified' %}bg-green-100 text-green-800
                            {% elif log.status == 'rejected' %}bg-red-100 text-red-800
                            {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                            {{ log.status|title }}
                        </span>
                    </td>
                    <td class="px-4 py-2 text-sm text-gray-600">{{ log.notes|truncatechars:50|default:"-" }}</td>
                    <td class="px-4 py-2 text-sm text-gray-600">{{ log.user.username|default:"System" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="px-4 py-4 text-center text-gray-500">
                        No verification actions recorded yet
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% if action_logs|length > 10 %}
    <div class="mt-4 text-center">
        <a href="{% url 'superadmin_tenant_verification_log' tenant.id %}" 
           class="text-sm text-blue-600 hover:text-blue-800">
            View all {{ action_logs|length }} actions â†’
        </a>
    </div>
    {% endif %}
</div>

<script>
    
   function verifyISP(tenantId) {
        const notes = document.getElementById('verificationNotes').value;
        
        if (confirm('Verify this ISP? This will enable full platform access.')) {
            fetch(`{% url 'superadmin_tenant_verify_api' tenant.id %}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    action: 'verify',
                    status: 'verified',
                    notes: notes
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success notification
                    showNotification('ISP verified successfully!', 'success');
                    
                    // Update UI without page reload
                    updateVerificationUI(true, data.verification_date);
                    
                    // Update the parent window if we're in an iframe or need to update main list
                    if (window.opener) {
                        window.opener.postMessage({
                            type: 'tenant_verified',
                            tenantId: '{{ tenant.id }}',
                            is_verified: true
                        }, '*');
                    }
                    
                } else {
                    showNotification('Error verifying ISP: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error verifying ISP', 'error');
            });
        }
    }
    
    function unverifyISP(tenantId) {
        const notes = document.getElementById('verificationNotes').value;
        
        if (confirm('Unverify this ISP? This will restrict platform access.')) {
            fetch(`{% url 'superadmin_tenant_verify_api' tenant.id %}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    action: 'unverify',
                    status: 'pending',
                    notes: notes
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('ISP unverified successfully!', 'success');
                    updateVerificationUI(false, null);
                    
                    if (window.opener) {
                        window.opener.postMessage({
                            type: 'tenant_unverified',
                            tenantId: '{{ tenant.id }}',
                            is_verified: false
                        }, '*');
                    }
                } else {
                    showNotification('Error unverifying ISP: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error unverifying ISP', 'error');
            });
        }
    }
    
    function updateVerificationStatus(tenantId, status) {
        const notes = document.getElementById('verificationNotes').value;
        const statusMessages = {
            'verified': 'Verify this ISP?',
            'pending': 'Mark as pending verification?',
            'rejected': 'Reject this ISP?'
        };
        
        if (confirm(statusMessages[status])) {
            fetch(`{% url 'superadmin_tenant_verify_api' tenant.id %}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    action: 'update_status',
                    status: status,
                    notes: notes
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(`ISP ${status} successfully!`, 'success');
                    updateVerificationUI(status === 'verified', data.verification_date);
                    
                    if (window.opener) {
                        window.opener.postMessage({
                            type: 'tenant_status_updated',
                            tenantId: '{{ tenant.id }}',
                            is_verified: status === 'verified',
                            status: status
                        }, '*');
                    }
                } else {
                    showNotification(`Error updating status: ${data.message}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error updating status', 'error');
            });
        }
    }
    
    function updateVerificationUI(isVerified, verificationDate) {
        // Update verification status badge
        const statusSpan = document.querySelector('.flex.items-center.space-x-3.mt-2 span:first-child');
        if (statusSpan) {
            if (isVerified) {
                statusSpan.className = 'px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-800 flex items-center';
                statusSpan.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Verified';
                
                // Update verification date if available
                if (verificationDate) {
                    const dateSpan = statusSpan.nextElementSibling;
                    if (dateSpan) {
                        dateSpan.textContent = `Verified on ${new Date(verificationDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`;
                    }
                }
                
                // Update action button
                const actionButton = document.querySelector('div:has(> button) > button');
                if (actionButton) {
                    actionButton.className = 'px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg';
                    actionButton.innerHTML = '<i class="fas fa-times-circle mr-2"></i> Unverify ISP';
                    actionButton.onclick = function() { unverifyISP('{{ tenant.id }}'); };
                }
            } else {
                statusSpan.className = 'px-4 py-2 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 flex items-center';
                statusSpan.innerHTML = '<i class="fas fa-clock mr-2"></i> Pending Verification';
                
                const dateSpan = statusSpan.nextElementSibling;
                if (dateSpan) {
                    dateSpan.textContent = `Submitted on {{ tenant.created_at|date:"F d, Y" }}`;
                }
                
                // Update action button
                const actionButton = document.querySelector('div:has(> button) > button');
                if (actionButton) {
                    actionButton.className = 'px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg';
                    actionButton.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Verify ISP';
                    actionButton.onclick = function() { verifyISP('{{ tenant.id }}'); };
                }
            }
        }
    }
    
    function showNotification(message, type = 'info') {
        // Remove existing notifications
        const existingNotifications = document.querySelectorAll('.notification-toast');
        existingNotifications.forEach(note => note.remove());
        
        const notification = document.createElement('div');
        notification.className = `notification-toast fixed top-4 right-4 px-4 py-3 rounded-lg shadow-lg z-50 animate-slide-in ${
            type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
            type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
            'bg-blue-100 text-blue-800 border border-blue-200'
        }`;
        
        const icon = type === 'success' ? 'check-circle' : 
                    type === 'error' ? 'exclamation-circle' : 'info-circle';
        
        notification.innerHTML = `
            <div class="flex items-center">
                <i class="fas fa-${icon} mr-2"></i>
                <span class="font-medium">${message}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (notification.parentElement) {
                notification.style.animation = 'slide-out 0.3s ease forwards';
                setTimeout(() => notification.remove(), 300);
            }
        }, 5000);
    }
    
    // Add CSS for animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slide-out {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        .animate-slide-in {
            animation: slide-in 0.3s ease forwards;
        }
    `;
    document.head.appendChild(style);
    
    // Listen for messages from parent window (if needed)
    window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'update_verification_status') {
            updateVerificationUI(event.data.is_verified, event.data.verification_date);
        }
    });
    
    function requestDocument(tenantId, documentType) {
        const documentNames = {
            'business_registration': 'Business Registration Certificate',
            'tax_certificate': 'Tax Compliance Certificate',
            'id_document': 'Director ID Document'
        };
        
        const documentName = documentNames[documentType];
        
        if (confirm(`Request ${documentName} from this ISP? An email will be sent.`)) {
            // CHANGED: Use Django URL template tag (create this view if needed)
            fetch(`{% url 'superadmin_request_document' tenant.id %}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    document_type: documentType,
                    action: 'request_document'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`Document request sent to ISP!`);
                } else {
                    alert(`Error requesting document: ${data.message}`);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error requesting document');
            });
        }
    }
    
    function exportVerificationLog(tenantId) {
        window.location.href = `{% url 'superadmin_verification_log_export' tenant.id %}`;
    }
</script>
{% endblock %}