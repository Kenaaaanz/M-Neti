{% extends 'accounts/superadmin_base.html' %}
{% load static %}

{% block title %}Create Bandwidth Package - M-Neti{% endblock %}

{% block page_title %}Create Bandwidth Package{% endblock %}
{% block page_subtitle %}Add new bulk bandwidth package to marketplace{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <!-- Vendor Selection -->
            <div class="space-y-4">
                <h3 class="text-lg font-medium text-gray-900">Vendor Information</h3>
                
                <div>
                    <label for="vendor_id" class="block text-sm font-medium text-gray-700 mb-1">
                        Select Vendor *
                    </label>
                    <select id="vendor_id" name="vendor_id" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">-- Select Vendor --</option>
                        {% for vendor in vendors %}
                        <option value="{{ vendor.id }}">{{ vendor.name }} - {{ vendor.company_name }}</option>
                        {% endfor %}
                    </select>
                    <p class="mt-1 text-sm text-gray-500">Choose the vendor selling this bandwidth</p>
                </div>
            </div>
            
            <!-- Package Details -->
            <div class="space-y-4">
                <h3 class="text-lg font-medium text-gray-900">Package Details</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
                            Package Name *
                        </label>
                        <input type="text" id="name" name="name" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="e.g., 100Mbps Dedicated">
                    </div>
                    
                    <div>
                        <label for="package_type" class="block text-sm font-medium text-gray-700 mb-1">
                            Package Type *
                        </label>
                        <select id="package_type" name="package_type" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="dedicated">Dedicated Bandwidth</option>
                            <option value="shared">Shared Bandwidth</option>
                            <option value="burst">Burst Bandwidth</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="bandwidth_amount" class="block text-sm font-medium text-gray-700 mb-1">
                            Bandwidth Amount *
                        </label>
                        <input type="number" id="bandwidth_amount" name="bandwidth_amount" required step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="e.g., 100">
                    </div>
                    
                    <div>
                        <label for="unit" class="block text-sm font-medium text-gray-700 mb-1">
                            Unit *
                        </label>
                        <select id="unit" name="unit" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="mbps">Mbps</option>
                            <option value="gbps">Gbps</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="validity_days" class="block text-sm font-medium text-gray-700 mb-1">
                            Validity Period (Days) *
                        </label>
                        <input type="number" id="validity_days" name="validity_days" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               value="30" min="1">
                    </div>
                </div>
            </div>
            
            <!-- Technical Specifications -->
            <div class="space-y-4">
                <h3 class="text-lg font-medium text-gray-900">Technical Specifications</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="upstream_commit" class="block text-sm font-medium text-gray-700 mb-1">
                            Upstream Commit (Mbps)
                        </label>
                        <input type="number" id="upstream_commit" name="upstream_commit" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Optional">
                    </div>
                    
                    <div>
                        <label for="downstream_commit" class="block text-sm font-medium text-gray-700 mb-1">
                            Downstream Commit (Mbps)
                        </label>
                        <input type="number" id="downstream_commit" name="downstream_commit" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Optional">
                    </div>
                    
                    <div>
                        <label for="burst_limit" class="block text-sm font-medium text-gray-700 mb-1">
                            Burst Limit (Mbps)
                        </label>
                        <input type="number" id="burst_limit" name="burst_limit" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Optional">
                    </div>
                </div>
            </div>
            
            <!-- Pricing -->
            <div class="space-y-4">
                <h3 class="text-lg font-medium text-gray-900">Pricing & Commission</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="base_cost" class="block text-sm font-medium text-gray-700 mb-1">
                            Base Cost (Vendor Price) *
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500">KSh</span>
                            </div>
                            <input type="number" id="base_cost" name="base_cost" required step="0.01"
                                   class="w-full pl-12 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="0.00">
                        </div>
                    </div>
                    
                    <div>
                        <label for="selling_price" class="block text-sm font-medium text-gray-700 mb-1">
                            Selling Price (ISP Price) *
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500">KSh</span>
                            </div>
                            <input type="number" id="selling_price" name="selling_price" required step="0.01"
                                   class="w-full pl-12 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="0.00">
                        </div>
                    </div>
                    
                    <div>
                        <label for="commission_rate" class="block text-sm font-medium text-gray-700 mb-1">
                            Platform Commission (%) *
                        </label>
                        <div class="relative">
                            <input type="number" id="commission_rate" name="commission_rate" required step="0.1"
                                   class="w-full pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   value="7.5" min="0" max="100">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <span class="text-gray-500">%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Price Preview -->
                <div class="bg-blue-50 border border-blue-100 rounded-lg p-4">
                    <h4 class="font-medium text-blue-900 mb-2">Price Breakdown Preview</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div class="text-center">
                            <p class="text-sm text-blue-700">Vendor Gets</p>
                            <p id="vendor-amount" class="text-lg font-bold text-blue-900">KSh 0.00</p>
                        </div>
                        <div class="text-center">
                            <p class="text-sm text-green-700">Platform Commission</p>
                            <p id="commission-amount" class="text-lg font-bold text-green-900">KSh 0.00</p>
                        </div>
                        <div class="text-center">
                            <p class="text-sm text-purple-700">ISP Pays</p>
                            <p id="selling-price-display" class="text-lg font-bold text-purple-900">KSh 0.00</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                <a href="{% url 'superadmin_bulk_bandwidth' %}" 
                   class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                    Cancel
                </a>
                
                <div class="flex space-x-3">
                    <button type="button" onclick="resetForm()"
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Reset
                    </button>
                    
                    <button type="submit"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500">
                        Create Bandwidth Package
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
// Price calculation preview
function calculatePreview() {
    const sellingPrice = parseFloat(document.getElementById('selling_price').value) || 0;
    const commissionRate = parseFloat(document.getElementById('commission_rate').value) || 0;
    const baseCost = parseFloat(document.getElementById('base_cost').value) || 0;
    
    const commissionAmount = (sellingPrice * commissionRate) / 100;
    const vendorAmount = baseCost;
    
    document.getElementById('selling-price-display').textContent = `KSh ${sellingPrice.toFixed(2)}`;
    document.getElementById('commission-amount').textContent = `KSh ${commissionAmount.toFixed(2)}`;
    document.getElementById('vendor-amount').textContent = `KSh ${vendorAmount.toFixed(2)}`;
}

// Add event listeners for price calculation
document.getElementById('selling_price').addEventListener('input', calculatePreview);
document.getElementById('commission_rate').addEventListener('input', calculatePreview);
document.getElementById('base_cost').addEventListener('input', calculatePreview);

// Reset form function
function resetForm() {
    if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
        document.querySelector('form').reset();
        calculatePreview();
    }
}

// Initialize preview on page load
document.addEventListener('DOMContentLoaded', calculatePreview);
</script>
{% endblock %}